---
title: youtube-dl python
date: 2021-02-19 17:12:04
tags:
---

오래전부터 음악파일을 들어왔기에 지금까지도 스트리밍 대신 음악 파일을 기기에 넣고 듣는다.
유튜브에서 노래를 찾아듣기 시작한 이후 youtube downloader를 사용하다 youtube-dl을 알게 되었다.
youtube premium이나 youtube music을 사용하는 것보다 프로그래밍할 수 있는 무언가를 만드는게 재밌어 보여서 시작한 프로젝트였다.
내가 노래를 듣는 방식은 이렇다.
iOS에 음악 플레이어 기능이 있는 FTP앱을 사용해서 서버에 연결한다.
듣고싶은 노래가 있으면 유튜브 플레이리스트에 추가한다.
서버에서는 매일 새벽1시에 내 플레이리스트의 곡 정보를 확인하며 새로 추가된 곡을 youtube-dl을 통해 다운받는다.

youtube-dl, 쉘스크립트, cron job을 사용했는데 몇개월쯤 쓰다보니 여러 불편함을 느껴서 개선할 필요가 있었다.
플레이리스트에 삭제된 동영상이 포함된 경우 그 영상을 다운받으려 시도하다 에러가 나서 다운이 되지 않는 문제가 있었다. 그동안 새로 추가한 노래가 다운되지 않았는데 이 사실은 나중에 알게 되었고, 로깅과 에러 탐지가 필요하다고 느꼈다.

플레이리스트에 새로 추가된 곡만 다운받기 위해 이미 다운받은 곡의 정보를 저장해둔다. 텍스트파일에 youtube 동영상의 id 를 저장해두고 비교하는데, 문제가 되지는 않지만 개선하는 김에 데이터베이스를 써보고 싶었다. 데이터베이스에서 곡을 다운받은 날짜와 플레이리스트에서 삭제된 곡, 파일이 삭제된 곡 을 알수 있게 해보고 싶었다.

C, C++, Swift는 손에 익은 언어였지만 상대적으로 python은 필요할 때만 사용하는 덜 능숙한 언어이고,
youtube-dl의 python 패키지와 PyMongo를 이용하면 내가 원하는 기능을 구현할 수 있겠다 싶어 python으로 개발하는 중이다.

우분투에서 재부팅을 할때마다 mongod 서비스가 문제가 생겨서 임시방편으로 해결했는데 이대로는 안되겠다 싶어 mongoDB EC2 인스턴스를 하나 만들었다.
오랜만에 Elastic IP, Security group 을 설정했고, mongodb.conf를 수정한 뒤 root 계정을 만들어서 연결까지 끝마쳤다.


